#==============================================================================
#  Compare models with for 9aCN but different time series                  ----
#==============================================================================
cpl <- list(run2020,run2020.DEPM,run3,run6,run9)
cpl.sum <- SSsummarize(biglist=cpl)
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(2,8,10,12),xlim=c(1978,2021),print = TRUE,plotdir = res.dir,
legendlabels = c("Assm2020","AssmDEPM","All","1997","2013"),legendloc = "topright",filenameprefix = "SameAreaDiffYears")
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(2),xlim=c(1978,2021),print = TRUE,plotdir = res.dir,
legendlabels = c("Assm2020","AssmDEPM","All","1997","2013"),legendloc = "topright",filenameprefix = "SameAreaDiffYears")
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(3),xlim=c(1978,2021),print = TRUE,plotdir = res.dir,
legendlabels = c("Assm2020","AssmDEPM","All","1997","2013"),legendloc = "topright",filenameprefix = "SameAreaDiffYears")
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(4),xlim=c(1978,2021),print = TRUE,plotdir = res.dir,
legendlabels = c("Assm2020","AssmDEPM","All","1997","2013"),legendloc = "topright",filenameprefix = "SameAreaDiffYears")
xx <- SStableComparisons(cpl.sum,models = "all",likenames = c("TOTAL","Survey", "Age_comp"),
names = c("SSB_2020","Recr_2020","F_2019"), digits = rep(2,16),
verbose = TRUE,mcmc = FALSE)
xx <- rbind(xx,c("Maximum Gradient",cpl.sum$maxgrad))
xx <- rbind(xx,cpl.sum$likelihoods[c(2,3,6,9,10),c(ncol(cpl.sum$likelihoods),1:(ncol(cpl.sum$likelihoods)-1))])
xx <- rbind(xx,c("Number parameters",cpl.sum$npars))
AIC <- c(Label="AIC", cpl.sum$npars*2+(2*cpl.sum$likelihoods[1,-ncol(cpl.sum$likelihoods)]))
xx <- rbind(xx,AIC)
xx <- xx[c(1,8,9,2,3,10:13,4:6,14,7),]
xx$Label <- c("Total","Catch","Equil_catch","Survey","Age_comp","Recruitment","Parm_softbounds","Parm_devs","N parm","SSB_2020",
"Recr_2020","F_2019","AIC","Max Grad")
xx%>%
gt::gt()%>%
gt::gtsave("tblCompModel9aCNDiffYears.tex")
xx
round(cpl.sum$maxgrad,2)
cpl.sum$maxgrad
format(cpl.sum$maxgrad,scientifc=F)
format(cpl.sum$maxgrad,trim = F)
format(cpl.sum$maxgrad,trim = T)
format(cpl.sum$maxgrad,digits = 3)
as.numeric(format(cpl.sum$maxgrad,digits = 3))
xx <- SStableComparisons(cpl.sum,models = "all",likenames = c("TOTAL","Survey", "Age_comp"),
names = c("SSB_2020","Recr_2020","F_2019"), digits = rep(2,16),
verbose = TRUE,mcmc = FALSE)
xx
xx <- rbind(xx,c("Maximum Gradient", as.numeric(format(cpl.sum$maxgrad,digits = 3))))
xx
xx <- rbind(xx,cpl.sum$likelihoods[c(2,3,6,9,10),c(ncol(cpl.sum$likelihoods),1:(ncol(cpl.sum$likelihoods)-1))])
xx
cpl.sum$likelihoods[c(2,3,6,9,10),c(ncol(cpl.sum$likelihoods),1:(ncol(cpl.sum$likelihoods)-1))]
xx <- SStableComparisons(cpl.sum,models = "all",likenames = c("TOTAL","Survey", "Age_comp"),
names = c("SSB_2020","Recr_2020","F_2019"), digits = rep(2,16),
verbose = TRUE,mcmc = FALSE)
xx <- rbind(xx,c("Maximum Gradient", as.numeric(format(cpl.sum$maxgrad,digits = 3))))
xx <- rbind(xx,as.numeric(format(cpl.sum$likelihoods[c(2,3,6,9,10),c(ncol(cpl.sum$likelihoods),1:(ncol(cpl.sum$likelihoods)-1))],digits=3)))
xx <- rbind(xx,cpl.sum$likelihoods[c(2,3,6,9,10),c(ncol(cpl.sum$likelihoods),1:(ncol(cpl.sum$likelihoods)-1))])
xx <- SStableComparisons(cpl.sum,models = "all",likenames = c("TOTAL","Survey", "Age_comp"),
names = c("SSB_2020","Recr_2020","F_2019"), digits = rep(2,16),
verbose = TRUE,mcmc = FALSE)
xx <- rbind(xx,c("Maximum Gradient", as.numeric(format(cpl.sum$maxgrad,digits = 3))))
xx <- rbind(xx,cpl.sum$likelihoods[c(2,3,6,9,10),c(ncol(cpl.sum$likelihoods),1:(ncol(cpl.sum$likelihoods)-1))])
xx
xx[8:11,]
xx[8:11,2:6]
as.numeric(format(xx[8:11,2:6],digits=3))
str(xx[8:11,2:6])
as.numeric(format(as.numeric(xx[8:11,2:6],digits=3)))
as.numeric(xx[8:11,2:6])
xx <- rbind(xx,c("Number parameters",cpl.sum$npars))
AIC <- c(Label="AIC", cpl.sum$npars*2+(2*cpl.sum$likelihoods[1,-ncol(cpl.sum$likelihoods)]))
xx <- rbind(xx,AIC)
xx
xx[xx$Label=="Catch",]
str(xx[xx$Label=="Catch",])
as.numeric(format(xx[xx$Label=="Catch",]),digits=3)
as.numeric(format(xx[xx$Label=="Catch",2:6]),digits=3)
xx[xx$Label=="Catch",2:6] <- as.numeric(format(xx[xx$Label=="Catch",2:6]),digits=3)
xx
as.numeric(format(xx[xx$Label=="Catch",2:6]),digits=3)
as.numeric(format(xx[xx$Label=="Catch",2:6],digits=3))
format(xx[xx$Label=="Catch",2:6],digits=3)
format(xx[xx$Label=="Catch",2:6],digits=4)
format(xx[xx$Label=="Catch",2:6],digits=2)
format(xx[xx$Label=="Catch",2:6],digits=7)
format(as.numeric(xx[xx$Label=="Catch",2:6]),digits=3)
xx[xx$Label=="Catch",2:6] <- format(as.numeric(xx[xx$Label=="Catch",2:6]),digits=3)
xx <- SStableComparisons(cpl.sum,models = "all",likenames = c("TOTAL","Survey", "Age_comp"),
names = c("SSB_2020","Recr_2020","F_2019"), digits = rep(2,16),
verbose = TRUE,mcmc = FALSE)
xx <- rbind(xx,c("Maximum Gradient", as.numeric(format(cpl.sum$maxgrad,digits = 3))))
xx <- rbind(xx,cpl.sum$likelihoods[c(2,3,6,9,10),c(ncol(cpl.sum$likelihoods),1:(ncol(cpl.sum$likelihoods)-1))])
xx <- rbind(xx,c("Number parameters",cpl.sum$npars))
AIC <- c(Label="AIC", cpl.sum$npars*2+(2*cpl.sum$likelihoods[1,-ncol(cpl.sum$likelihoods)]))
xx <- rbind(xx,AIC)
xx <- xx[c(1,8,9,2,3,10:13,4:6,14,7),]
xx$Label <- c("Total","Catch","Equil_catch","Survey","Age_comp","Recruitment","Parm_softbounds","Parm_devs","N parm","SSB_2020",
"Recr_2020","F_2019","AIC","Max Grad")
xx[xx$Label=="Catch",2:6] <- format(as.numeric(xx[xx$Label=="Catch",2:6]),digits=3)
xx
xx[xx$Label=="Equil_catch",2:6] <- format(as.numeric(xx[xx$Label=="Equil_catch",2:6]),digits=3)
xx[xx$Label=="Recruitment",2:6] <- format(as.numeric(xx[xx$Label=="recruitment",2:6]),digits=3)
xx[xx$Label=="Parm_softbounds",2:6] <- format(as.numeric(xx[xx$Label=="Parm_softbounds",2:6]),digits=3)
c(Label="AIC", round(cpl.sum$npars*2+(2*cpl.sum$likelihoods[1,-ncol(cpl.sum$likelihoods)])),2)
xx <- SStableComparisons(cpl.sum,models = "all",likenames = c("TOTAL","Survey", "Age_comp"),
names = c("SSB_2020","Recr_2020","F_2019"), digits = rep(2,16),
verbose = TRUE,mcmc = FALSE)
xx <- rbind(xx,c("Maximum Gradient", as.numeric(format(cpl.sum$maxgrad,digits = 3))))
xx <- rbind(xx,cpl.sum$likelihoods[c(2,3,6,9,10),c(ncol(cpl.sum$likelihoods),1:(ncol(cpl.sum$likelihoods)-1))])
xx <- rbind(xx,c("Number parameters",cpl.sum$npars))
AIC <- c(Label="AIC", round(cpl.sum$npars*2+(2*cpl.sum$likelihoods[1,-ncol(cpl.sum$likelihoods)])),2)
xx <- rbind(xx,AIC)
xx <- xx[c(1,8,9,2,3,10:13,4:6,14,7),]
xx$Label <- c("Total","Catch","Equil_catch","Survey","Age_comp","Recruitment","Parm_softbounds","Parm_devs","N parm","SSB_2020",
"Recr_2020","F_2019","AIC","Max Grad")
xx[xx$Label=="Catch",2:6] <- format(as.numeric(xx[xx$Label=="Catch",2:6]),digits=3)
xx[xx$Label=="Equil_catch",2:6] <- format(as.numeric(xx[xx$Label=="Equil_catch",2:6]),digits=3)
xx[xx$Label=="Recruitment",2:6] <- format(as.numeric(xx[xx$Label=="Recruitment",2:6]),digits=3)
xx[xx$Label=="Parm_softbounds",2:6] <- format(as.numeric(xx[xx$Label=="Parm_softbounds",2:6]),digits=3)
xx <- SStableComparisons(cpl.sum,models = "all",likenames = c("TOTAL","Survey", "Age_comp"),
names = c("SSB_2020","Recr_2020","F_2019"), digits = rep(2,16),
verbose = TRUE,mcmc = FALSE)
xx <- rbind(xx,c("Maximum Gradient", as.numeric(format(cpl.sum$maxgrad,digits = 3))))
xx <- rbind(xx,cpl.sum$likelihoods[c(2,3,6,9,10),c(ncol(cpl.sum$likelihoods),1:(ncol(cpl.sum$likelihoods)-1))])
xx <- rbind(xx,c("Number parameters",cpl.sum$npars))
AIC <- c(Label="AIC", cpl.sum$npars*2+(2*cpl.sum$likelihoods[1,-ncol(cpl.sum$likelihoods)]))
xx <- rbind(xx,AIC)
xx <- xx[c(1,8,9,2,3,10:13,4:6,14,7),]
xx$Label <- c("Total","Catch","Equil_catch","Survey","Age_comp","Recruitment","Parm_softbounds","Parm_devs","N parm","SSB_2020",
"Recr_2020","F_2019","AIC","Max Grad")
xx[xx$Label=="Catch",2:6] <- format(as.numeric(xx[xx$Label=="Catch",2:6]),digits=3)
xx[xx$Label=="Equil_catch",2:6] <- format(as.numeric(xx[xx$Label=="Equil_catch",2:6]),digits=3)
xx[xx$Label=="Recruitment",2:6] <- format(as.numeric(xx[xx$Label=="Recruitment",2:6]),digits=3)
xx[xx$Label=="Parm_softbounds",2:6] <- format(as.numeric(xx[xx$Label=="Parm_softbounds",2:6]),digits=3)
xx
str(xx[xx$Label=="Parm_softbounds",2:6])
format(as.numeric(xx[xx$Label=="Parm_softbounds",2:6]),digits=3)
xx
format(as.numeric(xx[xx$Label=="Recruitment",2:6]),digits=3)
as.numeric(xx[xx$Label=="Parm_softbounds",2:6])
format(as.numeric(xx[xx$Label=="Parm_softbounds",2:6]),scientific = T)
xx <- SStableComparisons(cpl.sum,models = "all",likenames = c("TOTAL","Survey", "Age_comp"),
names = c("SSB_2020","Recr_2020","F_2019"), digits = rep(2,16),
verbose = TRUE,mcmc = FALSE)
xx <- rbind(xx,c("Maximum Gradient", as.numeric(format(cpl.sum$maxgrad,digits = 3))))
xx <- rbind(xx,cpl.sum$likelihoods[c(2,3,6,9,10),c(ncol(cpl.sum$likelihoods),1:(ncol(cpl.sum$likelihoods)-1))])
xx <- rbind(xx,c("Number parameters",cpl.sum$npars))
AIC <- c(Label="AIC", cpl.sum$npars*2+(2*cpl.sum$likelihoods[1,-ncol(cpl.sum$likelihoods)]))
xx <- rbind(xx,AIC)
xx <- xx[c(1,8,9,2,3,10:13,4:6,14,7),]
xx$Label <- c("Total","Catch","Equil_catch","Survey","Age_comp","Recruitment","Parm_softbounds","Parm_devs","N parm","SSB_2020",
"Recr_2020","F_2019","AIC","Max Grad")
xx[xx$Label=="Catch",2:6] <- format(as.numeric(xx[xx$Label=="Catch",2:6]),digits=3)
xx[xx$Label=="Equil_catch",2:6] <- format(as.numeric(xx[xx$Label=="Equil_catch",2:6]),digits=3)
xx[xx$Label=="Recruitment",2:6] <- format(as.numeric(xx[xx$Label=="Recruitment",2:6]),digits=3)
xx[xx$Label=="Parm_softbounds",2:6] <- format(as.numeric(xx[xx$Label=="Parm_softbounds",2:6]),scientific = T)
xx
format(as.numeric(xx[xx$Label=="Parm_softbounds",2:6]),scientific = T)
xx[xx$Label=="Parm_softbounds",2:6] <- format(as.numeric(xx[xx$Label=="Parm_softbounds",2:6]),scientific = T,digits=3)
xx
xx%>%
gt::gt()%>%
gt::gtsave("tblCompModel9aCNDiffYears.tex")
xx%>%
gt::gt()%>%
gt::gtsave("tblCompModel9aCNDiffYears.png")
colnames(xx)
colnames(xx) <- c("Label", "Assm2020","AssmDEPM","1984-2020","1997-2020","2013-2020")
xx%>%
gt::gt()%>%
gt::gtsave("tblCompModel9aCNDiffYears.tex")
xx%>%
gt::gt()%>%
gt::gtsave("tblCompModel9aCNDiffYears.png")
diff <- function(file.path, name){
sso.run <- SS_read_summary(file = paste0(file.path,"/ss_summary.sso"),verbose = TRUE)
sso.dq <- sso.run$derived_quants[1:219,] %>% rownames_to_column("rn") %>% separate(rn, into = c("Variable", "Yr"))
sso.dq$Run <- name
return(sso.dq)
}
sso.dq2020 <- diff(file.path=paste0(res.ss,'/2020_Update'),"Assm2020")
sso.run4 <- diff(file.path=paste0(res.ss,'/run3'),"1984-2020")
sso.run8 <- diff(file.path=paste0(res.ss,'/run6'),"1997-2020")
sso.run12 <- diff(file.path=paste0(res.ss,'/run9'),"2013-2020")
sso.dq2020 <- diff(file.path=paste0(res.ss,'/2020_Update'),"Assm2020")
sso.run1 <- diff(file.path=paste0(res.ss,'/run3'),"1984-2020")
sso.run2 <- diff(file.path=paste0(res.ss,'/run6'),"1997-2020")
sso.run3 <- diff(file.path=paste0(res.ss,'/run9'),"2013-2020")
dd <-
full_join(
sso.dq2020 %>%
pivot_longer(cols = c(Value, SE), names_to = "Type") %>%
select(Variable, Yr, Type, Ass2020 = "value"),
bind_rows(sso.dq2020,sso.run1,sso.run2,sso.run3) %>%
pivot_longer(cols = c(Value, SE), names_to = "Type"),
by = c("Variable", "Yr", "Type")
) %>%
mutate(delta = Ass2020 - value)
dd %>%
filter(Yr %in% 1978:2020,Type == "Value", Variable %in% c('SSB','Recr','F')) %>%
mutate(Yr = as.numeric(as.character(Yr))) %>%
ggplot(aes(x=Yr,y=delta,color=Run))+
geom_line()+
facet_wrap(Variable ~ .,scale="free_y",nrow=3)
ggsave(paste0(res.plots,'/',"Diff9aCNYears.png"))
dd %>%
filter(Yr %in% 1978:2020,Type == "SE", Variable %in% c('SSB','Recr','F')) %>%
mutate(Yr = as.numeric(as.character(Yr))) %>%
ggplot(aes(x=Yr,y=delta,color=Run))+
geom_line()+
facet_wrap(Variable ~ .,scale="free_y",nrow=3)
ggsave(paste0(res.plots,'/',"SE_Diff9aCNYears.png"))
rm(list = ls(pattern = "^sso\\."))
wd <- "D:/ICES/IBPIS2021"
setwd(wd)
# directory to save plots
res.plots<-"D:/ICES/IBPIS2021/plots"
# directory with data
res.dir  <- file.path("./data")
srv <- read.table(paste0(res.dir,"/surveysData.csv"), header = TRUE,sep=",")
# Filter data set
srv <- srv %>%
filter(.,!survey2 %in% c("PELGAS", "ECOCADIZ","SAR-PT-SUM"))%>%
mutate(type = case_when(survey2 %in% c("SAR-PT-AUT","JUVESAR","ECOCADIZ-REC","IBERAS") ~ "REC",
TRUE~"B1plus"))%>%
group_by(type,survey2,year,cohort,age,area)%>%
summarise(number= sum(n,na.rm=T),
biomass= sum(b,na.rm=T))%>%
mutate(logN=log(number))
srv %>%
group_by(type,survey2,year)%>%
summarise(number=sum(number,na.rm=T),
biomass=sum(biomass,na.rm=T))
srv %>%
filter(age==0 & type =="REC")%>%
group_by(survey2,year)%>%
summarise(number=sum(number,na.rm=T),
biomass=sum(biomass,na.rm=T))%>%
group_by(survey2)%>%
mutate(meanN=mean(number,na.rm=T),meanB=mean(biomass,na.rm=T),sdN=sd(number,na.rm=T),sdB=sd(biomass,na.rm=T))
srv %>%
filter(age==0 & type =="REC")%>%
group_by(survey2,year)%>%
summarise(number=sum(number,na.rm=T),
biomass=sum(biomass,na.rm=T))%>%
group_by(survey2)%>%
mutate(meanN=mean(number,na.rm=T),meanB=mean(biomass,na.rm=T),sdN=sd(number,na.rm=T),sdB=sd(biomass,na.rm=T))%>%
pivot_longer(.,cols=c(3:4),names_to = "estimate")
srv %>%
filter(age==0 & type =="REC")%>%
group_by(survey2,year)%>%
summarise(number=sum(number,na.rm=T),
biomass=sum(biomass,na.rm=T))%>%
group_by(survey2)%>%
summarise(N=(number-(mean(number,na.rm=T)))/sd(number,na.rm=T))
srv %>%
filter(age==0 & type =="REC")%>%
group_by(survey2,year)%>%
summarise(number=sum(number,na.rm=T),
biomass=sum(biomass,na.rm=T))%>%
group_by(survey2)%>%
summarise(N=(number-(mean(number,na.rm=T)))/sd(number,na.rm=T),B=(biomass-(mean(biomass,na.rm=T)))/sd(biomass,na.rm=T))%>%
pivot_longer(.,cols=c(3:4),names_to = "estimate")%>%
ggplot(aes(y=value,x=year,colour=survey2))+
geom_point(alpha=0.4) + geom_line()+
scale_size( range=c(.1,10),name="")+
facet_grid(estimate ~ ., scales = 'free') +
viridis::scale_fill_viridis(discrete=TRUE, guide=FALSE, option="A") +
hrbrthemes::theme_ipsum() +
theme(legend.position="bottom") +
ylab("Age Zero") +
xlab("Year")
srv %>%
filter(age==0 & type =="REC")%>%
group_by(survey2,year)%>%
summarise(number=sum(number,na.rm=T),
biomass=sum(biomass,na.rm=T))%>%
group_by(survey2)%>%
mutate(N=(number-(mean(number,na.rm=T)))/sd(number,na.rm=T),B=(biomass-(mean(biomass,na.rm=T)))/sd(biomass,na.rm=T))
srv %>%
filter(age==0 & type =="REC")%>%
group_by(survey2,year)%>%
summarise(number=sum(number,na.rm=T),
biomass=sum(biomass,na.rm=T))%>%
group_by(survey2)%>%
mutate(N=(number-(mean(number,na.rm=T)))/sd(number,na.rm=T),B=(biomass-(mean(biomass,na.rm=T)))/sd(biomass,na.rm=T))%>%
pivot_longer(.,cols=c(5:6),names_to = "estimate")
srv %>%
filter(age==0 & type =="REC")%>%
group_by(survey2,year)%>%
summarise(number=sum(number,na.rm=T),
biomass=sum(biomass,na.rm=T))%>%
group_by(survey2)%>%
mutate(N=(number-(mean(number,na.rm=T)))/sd(number,na.rm=T),B=(biomass-(mean(biomass,na.rm=T)))/sd(biomass,na.rm=T))%>%
pivot_longer(.,cols=c(5:6),names_to = "estimate")%>%
ggplot(aes(y=value,x=year,colour=survey2))+
geom_point(alpha=0.4) + geom_line()+
scale_size( range=c(.1,10),name="")+
facet_grid(estimate ~ ., scales = 'free') +
viridis::scale_fill_viridis(discrete=TRUE, guide=FALSE, option="A") +
hrbrthemes::theme_ipsum() +
theme(legend.position="bottom") +
ylab("Age Zero") +
xlab("Year")
# - For age zero
srv %>%
filter(age==0 & type =="REC")%>%
group_by(survey2,year)%>%
summarise(number=sum(number,na.rm=T),
biomass=sum(biomass,na.rm=T))%>%
group_by(survey2)%>%
mutate(Number=(number-(mean(number,na.rm=T)))/sd(number,na.rm=T),Biomass=(biomass-(mean(biomass,na.rm=T)))/sd(biomass,na.rm=T))%>%
pivot_longer(.,cols=c(5:6),names_to = "estimate")%>%
ggplot(aes(y=value,x=year,colour=survey2))+
geom_point(alpha=0.4) + geom_line()+
scale_size( range=c(.1,10),name="")+
facet_grid(estimate ~ ., scales = 'free') +
viridis::scale_fill_viridis(discrete=TRUE, guide=FALSE, option="A") +
hrbrthemes::theme_ipsum() +
theme(legend.position="bottom") +
ylab("Age Zero") +
xlab("Year")
rm(list=ls())
#==============================================================================
# WORKING DIRECTORY                                                        ----
#==============================================================================
wd <- "D:/ICES/IBPIS2021"
setwd(wd)
# directory to save plots
res.plots <- file.path("./plots")
# directory with SS runs
res.ss <- file.path("./SS_runs")
# directory with data
res.dir  <- file.path("./data")
#==============================================================================
# LOAD LIBRARIES                                                           ----
#==============================================================================
library(r4ss)
library(tidyverse)
run2020 <- SS_output(dir = paste0(res.ss,"/2020_Update"),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE)
# The 2020 assessment model with the 2020 DEPM point estimate (was not available at the time)
run2020.DEPM <- SS_output(dir = paste0(res.ss,"/2020_DEPM"),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE)
# Setup a - Same settings as the current model but with new recruitment index
runa <- SS_output(dir = paste0(res.ss,'/Setupa'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE)
runb <- SS_output(dir = paste0(res.ss,'/Setupb'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE)
# Setup c - Different selectivity, no time blocks, S-at-age is dome shaped
runc <- SS_output(dir = paste0(res.ss,'/Setupc'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE)
cpl <- list(run2020,run2020.DEPM,run3,run6,run9)
cpl.sum <- SSsummarize(biglist=cpl)
cpl <- list(run2020,run2020.DEPM,runa,runb,runc)
cpl.sum <- SSsummarize(biglist=cpl)
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(2,8,10,12),xlim=c(1978,2021),print = TRUE,plotdir = res.plots,
legendlabels = c("Assm2020","AssmDEPM","Setup a","Setup b","Setup c"),legendloc = "topright",filenameprefix = "DiffSetups"))
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(2,8,10,12),xlim=c(1978,2021),print = TRUE,plotdir = res.plots,
legendlabels = c("Assm2020","AssmDEPM","Setup a","Setup b","Setup c"),legendloc = "topright",filenameprefix = "DiffSetups")
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(2),xlim=c(1978,2021),print = TRUE,plotdir = res.plots,
legendlabels = c("Assm2020","AssmDEPM","Setup a","Setup b","Setup c"),legendloc = "topright",filenameprefix = "DiffSetups")
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(3),xlim=c(1978,2021),print = TRUE,plotdir = res.plots,
legendlabels = c("Assm2020","AssmDEPM","Setup a","Setup b","Setup c"),legendloc = "topright",filenameprefix = "DiffSetups")
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(4),xlim=c(1978,2021),print = TRUE,plotdir = res.plots,
legendlabels = c("Assm2020","AssmDEPM","Setup a","Setup b","Setup c"),legendloc = "topright",filenameprefix = "DiffSetups")
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(4),xlim=c(1978,2021),print = TRUE,plotdir = res.plots,
legendlabels = c("Assm2020","AssmDEPM","Setup a","Setup b","Setup c"),legendloc = "topright",filenameprefix = "DiffSetups")
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(3),xlim=c(1978,2021),print = TRUE,plotdir = res.plots,
legendlabels = c("Assm2020","AssmDEPM","Setup a","Setup b","Setup c"),legendloc = "topright",filenameprefix = "DiffSetups")
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(4),xlim=c(1978,2021),print = TRUE,plotdir = res.plots,
legendlabels = c("Assm2020","AssmDEPM","Setup a","Setup b","Setup c"),legendloc = "topright",filenameprefix = "DiffSetups")
sso.run3 <- diff(file.path=paste0(res.ss,'/run2'),"G1, OC")
run1 <-  SS_output(dir = paste0(res.ss,'/run1'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # w/o ECO-REC all years
run2 <-  SS_output(dir = paste0(res.ss,'/run2'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # 9aCN and 9aCS all years
run3 <-  SS_output(dir = paste0(res.ss,'/run3'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # 9aCN all years
run4 <-  SS_output(dir = paste0(res.ss,'/run4'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # w/o ECO-REC from 1997
run5 <-  SS_output(dir = paste0(res.ss,'/run5'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # 9aCN and 9aCS from 1997
run6 <-  SS_output(dir = paste0(res.ss,'/run6'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # 9aCN from 1997
run7 <-  SS_output(dir = paste0(res.ss,'/run7'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # w/o ECO-REC from 2013
run8 <-  SS_output(dir = paste0(res.ss,'/run8'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # 9aCN and 9aCS from 2013
run9 <-  SS_output(dir = paste0(res.ss,'/run9'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # 9aCN from 2013
run10 <- SS_output(dir = paste0(res.ss,'/run10'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # all areas and years
run11 <- SS_output(dir = paste0(res.ss,'/run11'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # all areas from 1997
run12 <- SS_output(dir = paste0(res.ss,'/run12'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # all areas from 2013
cpl <- list(run2020,run2020.DEPM,run3,run6,run9)
cpl.sum <- SSsummarize(biglist=cpl)
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(2,8,10,12),xlim=c(1978,2021),print = TRUE,plotdir = res.dir,
legendlabels = c("Assm2020","AssmDEPM","All","1997","2013"),legendloc = "topright",filenameprefix = "SameAreaDiffYears")
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(2),xlim=c(1978,2021),print = TRUE,plotdir = res.dir,
legendlabels = c("Assm2020","AssmDEPM","All","1997","2013"),legendloc = "topright",filenameprefix = "SameAreaDiffYears")
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(3),xlim=c(1978,2021),print = TRUE,plotdir = res.dir,
legendlabels = c("Assm2020","AssmDEPM","All","1997","2013"),legendloc = "topright",filenameprefix = "SameAreaDiffYears")
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(4),xlim=c(1978,2021),print = TRUE,plotdir = res.dir,
legendlabels = c("Assm2020","AssmDEPM","All","1997","2013"),legendloc = "topright",filenameprefix = "SameAreaDiffYears")
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(4),xlim=c(1978,2021))
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(5),xlim=c(1978,2021))
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(3),xlim=c(1978,2021))
SSplotIndices()
SSplotIndices(run3)
SSplotIndices(run6)
SSplotIndices(run9)
SS_plots(run3)
SS_plots(run6)
SS_plots(run9)
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(4),xlim=c(1978,2021),print = TRUE,plotdir = res.dir,
legendlabels = c("Assm2020","AssmDEPM","All","1997","2013"),legendloc = "topright",filenameprefix = "SameAreaDiffYears")
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(4),xlim=c(1978,2021),print = TRUE,plotdir = res.dir,
legendlabels = c("All","1997","2013"),legendloc = "topright",filenameprefix = "SameAreaDiffYears")
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(4),xlim=c(1978,2021),print = TRUE,plotdir = res.dir,
legendlabels = c("Assm2020","AssmDEPM","All","1997","2013"),legendloc = "topright",filenameprefix = "SameAreaDiffYears")
cpl <- list(run3,run6,run9)
cpl.sum <- SSsummarize(biglist=cpl)
SSplotComparisons(summaryoutput=cpl.sum,subplots = c(13),indexfleets = c(4),xlim=c(1978,2021),print = TRUE,plotdir = res.dir,
legendlabels = c("All","1997","2013"),legendloc = "topright",filenameprefix = "SameAreaDiffYears")
SSplotComparisons(summaryoutput=SSsummarize(biglist=list(run3,run6,run9)),subplots = c(13),indexfleets = c(4),xlim=c(1978,2021),print = TRUE,plotdir = res.dir,
legendlabels = c("All","1997","2013"),legendloc = "topright",filenameprefix = "SameAreaDiffYears")
SSplotComparisons(summaryoutput=SSsummarize(biglist=list(runa,runb,runc)),subplots = c(13),indexfleets = c(4),xlim=c(1978,2021),print = TRUE,plotdir = res.plots,
legendlabels = c("Assm2020","AssmDEPM","Setup a","Setup b","Setup c"),legendloc = "topright",filenameprefix = "DiffSetups")
# - For age zero
srv %>%
filter(age==0 & type =="REC")%>%
group_by(survey2,year)%>%
summarise(number=sum(number,na.rm=T),
biomass=sum(biomass,na.rm=T))%>%
group_by(survey2)%>%
mutate(Number=(number-(mean(number,na.rm=T)))/sd(number,na.rm=T),Biomass=(biomass-(mean(biomass,na.rm=T)))/sd(biomass,na.rm=T))%>%
pivot_longer(.,cols=c(5:6),names_to = "estimate")%>%
ggplot(aes(y=value,x=year,colour=survey2))+
geom_point(alpha=0.4) + geom_line()+
scale_size( range=c(.1,10),name="")+
facet_grid(estimate ~ ., scales = 'free') +
viridis::scale_fill_viridis(discrete=TRUE, guide=FALSE, option="A") +
hrbrthemes::theme_ipsum() +
theme(legend.position="bottom") +
ylab("Age Zero") +
xlab("Year")
rm(list=ls())
#==============================================================================
# WORKING DIRECTORY                                                        ----
#==============================================================================
wd <- "D:/ICES/IBPIS2021"
setwd(wd)
# directory to save plots
res.plots<-"D:/ICES/IBPIS2021/plots"
# directory with data
res.dir  <- file.path("./data")
#==============================================================================
# LOAD LIBRARIES                                                           ----
#==============================================================================
library(tidyverse)
library(ggpubr) # for the ggscatter function
library(DEGreport) # for the geom_cor function
library(latex2exp) # for the function TeX
#==============================================================================
#  Read file with time series of survey data                               ----
#==============================================================================
srv <- read.table(paste0(res.dir,"/surveysData.csv"), header = TRUE,sep=",")
# Filter data set
srv <- srv %>%
filter(.,!survey2 %in% c("PELGAS", "ECOCADIZ","SAR-PT-SUM"))%>%
mutate(type = case_when(survey2 %in% c("SAR-PT-AUT","JUVESAR","ECOCADIZ-REC","IBERAS") ~ "REC",
TRUE~"B1plus"))%>%
group_by(type,survey2,year,cohort,age,area)%>%
summarise(number= sum(n,na.rm=T),
biomass= sum(b,na.rm=T))%>%
mutate(logN=log(number))
# - For age zero
srv %>%
filter(age==0 & type =="REC")%>%
group_by(survey2,year)%>%
summarise(number=sum(number,na.rm=T),
biomass=sum(biomass,na.rm=T))%>%
group_by(survey2)%>%
mutate(Number=(number-(mean(number,na.rm=T)))/sd(number,na.rm=T),Biomass=(biomass-(mean(biomass,na.rm=T)))/sd(biomass,na.rm=T))%>%
pivot_longer(.,cols=c(5:6),names_to = "estimate")%>%
ggplot(aes(y=value,x=year,colour=survey2))+
geom_point(alpha=0.4) + geom_line()+
scale_size( range=c(.1,10),name="")+
facet_grid(estimate ~ ., scales = 'free') +
viridis::scale_fill_viridis(discrete=TRUE, guide=FALSE, option="A") +
hrbrthemes::theme_ipsum() +
theme(legend.position="bottom") +
ylab("Age Zero") +
xlab("Year")
wd <- "D:/ICES/IBPIS2021"
setwd(wd)
# directory to save plots
res.plots <- file.path("./plots")
# directory with SS runs
res.ss <- file.path("./SS_runs")
# directory with data
res.dir  <- file.path("./data")
run2020 <- SS_output(dir = paste0(res.ss,"/2020_Update"),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE)
# The 2020 assessment model with the 2020 DEPM point estimate (was not available at the time)
run2020.DEPM <- SS_output(dir = paste0(res.ss,"/2020_DEPM"),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE)
# Setup a - Same settings as the current model but with new recruitment index
runa <- SS_output(dir = paste0(res.ss,'/Setupa'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE)
# Setup a - Same settings as the current model but with different recruitment index estimates (years and areas)
run1 <-  SS_output(dir = paste0(res.ss,'/run1'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # w/o ECO-REC all years
run2 <-  SS_output(dir = paste0(res.ss,'/run2'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # 9aCN and 9aCS all years
run3 <-  SS_output(dir = paste0(res.ss,'/run3'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # 9aCN all years
run4 <-  SS_output(dir = paste0(res.ss,'/run4'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # w/o ECO-REC from 1997
run5 <-  SS_output(dir = paste0(res.ss,'/run5'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # 9aCN and 9aCS from 1997
run6 <-  SS_output(dir = paste0(res.ss,'/run6'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # 9aCN from 1997
run7 <-  SS_output(dir = paste0(res.ss,'/run7'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # w/o ECO-REC from 2013
run8 <-  SS_output(dir = paste0(res.ss,'/run8'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # 9aCN and 9aCS from 2013
run9 <-  SS_output(dir = paste0(res.ss,'/run9'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # 9aCN from 2013
run10 <- SS_output(dir = paste0(res.ss,'/run10'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # all areas and years
run11 <- SS_output(dir = paste0(res.ss,'/run11'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # all areas from 1997
run12 <- SS_output(dir = paste0(res.ss,'/run12'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE) # all areas from 2013
# Setup b - Different selectivity, no time blocks, S-at-age is not dome shaped
runb <- SS_output(dir = paste0(res.ss,'/Setupb'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE)
# Setup c - Different selectivity, no time blocks, S-at-age is dome shaped
runc <- SS_output(dir = paste0(res.ss,'/Setupc'),forecast=FALSE,ncols=62,verbose = TRUE, printstats = TRUE)
# Make SS plots for each run
#SS_plots(runa)
#SS_plots(runb)
#SS_plots(runc)
#SS_plots(run2020.DEPM)
run3$index_variance_tuning_check
run2020$index_variance_tuning_check
run6$index_variance_tuning_check
run9$index_variance_tuning_check
